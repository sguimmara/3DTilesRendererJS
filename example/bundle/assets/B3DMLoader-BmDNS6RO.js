import{L as B,r as m,F as y,B as L}from"./readMagicBytes-CUUeQGnc.js";import{bq as w,k as x}from"./three.module-e-akeimH.js";import{G as U}from"./GLTFLoader-uVyzW9cX.js";class C extends B{parse(s){const t=new DataView(s),T=m(t);console.assert(T==="b3dm");const u=t.getUint32(4,!0);console.assert(u===1);const h=t.getUint32(8,!0);console.assert(h===s.byteLength);const o=t.getUint32(12,!0),a=t.getUint32(16,!0),n=t.getUint32(20,!0),r=t.getUint32(24,!0),b=28,e=s.slice(b,b+o+a),g=new y(e,0,o,a),c=b+o+a,i=s.slice(c,c+n+r),l=new L(i,g.getData("BATCH_LENGTH"),0,n,r),f=c+n+r,p=new Uint8Array(s,f,h-f);return{version:u,featureTable:g,batchTable:l,glbBytes:p}}}class S extends C{constructor(s=w){super(),this.manager=s,this.adjustmentTransform=new x}parse(s){const t=super.parse(s),T=t.glbBytes.slice().buffer;return new Promise((u,h)=>{const o=this.manager,a=this.fetchOptions,n=o.getHandler("path.gltf")||new U(o);a.credentials==="include"&&a.mode==="cors"&&n.setCrossOrigin("use-credentials"),"credentials"in a&&n.setWithCredentials(a.credentials==="include"),a.headers&&n.setRequestHeader(a.headers);let r=this.workingPath;!/[\\/]$/.test(r)&&r.length&&(r+="/");const b=this.adjustmentTransform;n.parse(T,r,e=>{const{batchTable:g,featureTable:c}=t,{scene:i}=e,l=c.getData("RTC_CENTER");l&&(i.position.x+=l[0],i.position.y+=l[1],i.position.z+=l[2]),e.scene.updateMatrix(),e.scene.matrix.multiply(b),e.scene.matrix.decompose(e.scene.position,e.scene.quaternion,e.scene.scale),e.batchTable=g,e.featureTable=c,i.batchTable=g,i.featureTable=c,u(e)},h)})}}export{S as B};
