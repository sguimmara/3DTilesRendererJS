import{r as u,d as R,u as T,j as k}from"./extends-BhbyWIdL.js";import{k as P,R as j,l as W,Q as A,i as M}from"./three.module-e-akeimH.js";import{a as C}from"./TilesLoadingBar-D9l6MEPE.js";const x=new P;function w(s,p,r){return r.makeTranslation(-s.x,-s.y,-s.z),x.makeRotationFromQuaternion(p),r.premultiply(x),x.makeTranslation(s.x,s.y,s.z),r.premultiply(x),r}const n=new j,t=new W,d=new W,m=new A,l=new P,z=u.forwardRef(function(p,r){const c=u.useContext(R),e=T(({controls:o})=>o),f=T(({scene:o})=>o),h=u.useCallback((o,i)=>{if(!o.animating){i.updateMatrixWorld(),n.ray.direction.set(0,0,-1).transformDirection(o.camera.matrixWorld),n.ray.origin.setFromMatrixPosition(o.camera.matrixWorld);const y=n.intersectObject(f)[0];if(y?(o.fixedPoint.copy(y.point),o.syncCameras()):(e.getPivotPoint(o.fixedPoint),o.syncCameras()),c?(l.copy(c.group.matrixWorld).invert(),t.copy(o.fixedPoint).applyMatrix4(l),c.ellipsoid.getPositionToNormal(t,t).multiplyScalar(-1).transformDirection(c.group.matrixWorld)):t.set(0,-1,0),i.isOrthographicCamera){const a=t.angleTo(n.ray.direction);d.crossVectors(t,n.ray.direction),m.setFromAxisAngle(d,-a).normalize(),w(o.fixedPoint,m,l),i.matrixWorld.premultiply(l),i.matrixWorld.decompose(i.position,i.quaternion,i.scale)}else if(!e.isGlobeControls||e._isNearControls()){let a=t.angleTo(n.ray.direction);a=Math.max(65*M.DEG2RAD-a,0),d.set(1,0,0).transformDirection(i.matrixWorld),m.setFromAxisAngle(d,a).normalize(),w(o.fixedPoint,m,l),i.matrixWorld.premultiply(l),i.matrixWorld.decompose(i.position,i.quaternion,i.scale)}}e.adjustCamera(o.perspectiveCamera),e.adjustCamera(o.orthographicCamera)},[c,e,f]);return k.jsx(C,{...p,ref:r,onBeforeToggle:h})});export{z as C};
